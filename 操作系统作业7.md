1. 文件系统的性能对整体系统的性能影响很大，请总结在实现文件系统时可以从哪些方面提高文件系统的性能，简要给出这些手段的具体解决思路。

   1. 使用多级目录：多级目录层次清楚、可解决文件重名问题、查找速度快。
   2. 使用索引文件：既保持了链接结构的优点，又能随机存取，满足文件动态增长、插入删除等要求，能充分利用外存空间。
   3. 时而整理磁盘碎片：访问文件的存储能够连续，文件碎片过多会导致存取文件时来回寻找，性能降低。
   4. 目录项分解：把目录项（文件控制块）分为两部分
      - 名号目录项，包含文件名以及相应的文件内部号
      - 基本目录项，包含了除文件名外文件控制块的其他全部信息
   5. 当前目录：快速搜索、定位到某个文件。
   6. 块高速缓存：在内存中缓存一些磁盘块的信息提高访问速度；使用更大的块高速缓存能直接减少对磁盘的访问次数，提升文件系统读写性能。
   7. 磁盘调度：在访问磁盘时减少磁头臂的移动，减少寻道时间，改善进程对磁盘的平均访问时间。
   8. 提前读：访问一个磁盘块时，基于对程序访问局部性的考虑，将连续的磁盘块也读入内存。
   9. 合理分配磁盘空间、信息的优化分布、RAID 技术等。

2. 简述文件控制块(FCB)的主要内容。

   1. 基本信息
      1. 字符串，通常在不同系统中允许不用的最大长度，可修改
      2. 物理位置
      3. 文件逻辑结构：有/无结构（记录文件，流式文件）
      4. 文件物理结构：顺序、索引等
   2. 访问控制信息
      1. 文件所有者（属主）：通常是创建文件的用户，或者改变已有的文件的属主。
      2. 访问权限（控制各用户可使用的访问方式）：读、写、执行、删除等
   3. 使用信息
      1. 创建时间
      2. 上一次修改时间
      3. 当前使用信息等

3. 在I/O系统中引入缓冲的主要原因是什么?

   1. 缓和 CPU 于 I/O 设备间速度不匹配的矛盾。
   2. 减少对 CPU 的终端频率，放宽对 CPU 终端响应时间的限制。
   3. 解决基本数据单元大小不匹配的问题。
   4. 提高 CPU 和 I/O 设备之间的并行性。

   分别计算在单缓冲区和双缓冲区结构下，分析完该文件的时间是多少？

   1. 单缓冲区

      ![截屏2022-05-29 22.52.00](https://raw.githubusercontent.com/hjc-owo/hjc-owo.github.io/img/202205292253019.png)

      如图所示，$10\times 150 \mathrm{\mu s} + 50\mathrm{\mu s}= 1550 \mathrm{\mu s}$

   2. 双缓冲区

      ![截屏2022-05-29 23.07.33](https://raw.githubusercontent.com/hjc-owo/hjc-owo.github.io/img/202205292309459.png)

      如图所示，$10\times 100 \mathrm{\mu s} + 100\mathrm{\mu s}= 1100 \mathrm{\mu s}$

4. 以下各算法所需的寻道时间是多少

   1. 先来先服务

      寻道顺序：$10$ $35$ $20$ $70$ $2$ $3$ $38$

      移动距离：$5+25+15+50+68+1+35=199$
      
      寻道时间：$199\times 6\mathrm{ms} = 1194\mathrm{ms}$
      
   2. 最短寻道时间优先
   
      寻道顺序：$10$ $3$ $2$ $20$ $35$ $38$ $70$
   
      移动距离：$5+7+1+18+15+3+32=81$
   
      寻道时间：$81\times 6\mathrm{ms} = 486\mathrm{ms}$
   
   3. SCAN 算法
   
      寻道顺序：$20$ $35$ $38$ $70$ $85^*$ $10$ $3$ $2$
   
      移动距离：$(85-15)+(85-2) = 153$
   
      寻道时间：$153\times 6\mathrm{ms} = 918\mathrm{ms}$
   
   4. LOOK 算法
   
      寻道顺序：$20$ $35$ $38$ $70$ $10$ $3$ $2$
   
      移动距离：$(70-15)+(70-2) = 123$
   
      寻道时间：$123\times 6\mathrm{ms} = 738\mathrm{ms}$
   
5. 回答以下问题

   1. 访问文件$f$中的一个块平均需要访问几次磁盘？

      1. 访问二级目录：根目录的目录项已经读入内存，那么读取二级目录不需要访问磁盘。

      2. 访问三级目录：一个磁盘块$1\mathrm{KB}$，每个目录项$128\mathrm{B}$，那么一个磁盘块可以放$\dfrac{1\mathrm{KB}}{128\mathrm{B}} = 8$个目录项；而如图所示每个二级目录下有$128$个三级目录，这些三级目录分布在$\dfrac{128}{8}=16$个磁盘块上。串联文件形式，访问一个三级目录项至少访问$1$次磁盘，至多访问$16$次磁盘，平均$8.5$次。

      3. 访问文件$f$中的一个块：文件平均大小$100\mathrm{KB}$，每个磁盘块$1\mathrm{KB}$，每个文件平均要分布在$\dfrac{100\mathrm{KB}}{1\mathrm{KB}} = 100$个磁盘块上。串联文件形式，访问一个块至少访问$1$次磁盘，至多访问$100$次，平均$50.5$次。

      4. 综上，平均共需要访问磁盘$0+8.5+50.5=59$次。

   2. 如果采用$i$节点的方法来构建文件目录，访问第三级目录下的一个文件的一个块平均需要访问几次磁盘？

      1. 访问二级目录：访问二级目录的$i$节点$1$次，访问二级目录内容$1$次，共$2$次。
      2. 访问三级目录：访问三级目录的$i$节点$1$次。访问三级目录内容时，一个目录项只占$14+2=16$个字节，那么一个磁盘块可以存放$\dfrac{1\mathrm{KB}}{16\mathrm{B}} = 64$个目录项，每个二级目录下有$128$个三级目录，分布在$\dfrac{128}{84}=2$个磁盘块上，因此访问三级目录的内容至少访问磁盘$1$次，至多访问磁盘$2$次，平均$1.5$次。因此访问三级目录平均访问磁盘$2.5$次。
      3. 访问文件磁盘块：访问磁盘块的$i$节点1次，访问磁盘块$1$次，共$2$次。
      4. 综上，平均共需要访问磁盘$2+2.5+2=6.5$次

   3. 假设该文件系统的空间最大容量为 $16\mathrm{ZB}(1\mathrm{ZB}=2^{70}\mathrm{B})$。如果文件的 FCB 中包括$512$字节的索引区，且允许采用一级索引进行组织，那么该文件系统支持的最大文件是多少字节？

      文件系统最多允许记录的磁盘块数为$\dfrac{16\mathrm{ZB}}{1\mathrm{KB}} = 2^{64}$个磁盘块。为表示这些磁盘块，需要$64$位，即$8$字节空间。inode中的索引区可以存放$\dfrac{512\mathrm{B}}{8\mathrm{B}} = 64$个磁盘块，一级索引指向的磁盘块中可存储$\dfrac{1\mathrm{KB}}{8\mathrm{B}} = 128$个磁盘块号，在采用一级索引的情况下，支持的最大文件为$64\times 128\times 1\mathrm{KB} = 8\mathrm{MB}$。